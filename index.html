<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seguridad Delagente</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0b1220;
      --card: #0f172a;
      --soft: #111827;
      --text: #e5e7eb;
      --muted:#9ca3af;
      --accent:#22c55e;
      --accent-2:#0ea5e9;
      --border:#1f2937;
      --danger:#ef4444;
    }
    [data-theme="light"]{
      --bg:#f6f7fb;
      --card:#fff;
      --soft:#f1f5f9;
      --text:#0f172a;
      --muted:#475569;
      --border:#e5e7eb;
      --accent:#22c55e;
      --accent-2:#2563eb;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; color:var(--text); background:var(--bg)}
    header{display:flex;align-items:center;gap:12px;padding:16px 20px;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10}
    header h1{font-size:20px;margin:0; font-weight:700}
    .nav{margin-left:auto; display:flex; gap:10px}
    .btn{border:1px solid var(--border);background:var(--soft);color:var(--text);padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#06110a}
    .container{max-width:1200px;margin:24px auto;padding:0 16px}

    /* Tarjetas */
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:1fr}
    @media(min-width:1100px){ .grid-3{grid-template-columns:1.2fr 1fr 1.2fr} .grid-2{grid-template-columns:1fr 1fr} }

    /* Tabs */
    .tabs{display:flex;gap:8px;margin-bottom:16px}
    .tabbtn{border:1px solid var(--border);background:var(--soft);padding:8px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    .tabbtn.active{background:var(--accent-2);border-color:var(--accent-2);color:#fff}
    .hidden{display:none !important}
    .muted{color:var(--muted);}

    /* Checklist */
    .catCard{background:var(--card);border:1px solid var(--border);border-radius:16px;margin-bottom:20px}
    .catHead{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border)}
    .catTitle{font-size:20px;font-weight:800;margin:0}
    .chip{background:var(--soft);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-weight:600;color:var(--muted)}
    .list{padding:8px 8px 16px}
    .itemRow{display:grid;grid-template-columns:auto 1fr;gap:14px;padding:14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg, var(--soft), transparent 60%);margin:10px}
    .itemTitle{margin:0; font-weight:700;font-size:16px}
    .badge{border-radius:999px;padding:2px 10px;border:1px solid var(--border);font-size:12px;font-weight:700;display:inline-block;margin-left:10px}
    .badge.essential{background:#10b98122;color:#059669;border-color:#10b98155}
    .badge.optional{background:#60a5fa22;color:#2563eb;border-color:#60a5fa55}
    .badge.advanced{background:#f472b622;color:#be185d;border-color:#f472b655}
    .itemDesc{margin:4px 0 0 0;color:var(--muted);line-height:1.4}
    .rowTop{display:flex;align-items:center;gap:10px}
    .rowLeft{display:flex;align-items:flex-start;gap:12px}
    .rowRight{display:block}
    input[type="checkbox"]{width:20px;height:20px;cursor:pointer}

    /* Global progress */
    .progressWrap{height:10px;background:var(--soft);border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .progressBar{height:100%;background:var(--accent);width:0%}
    .kpi{background:var(--card);border:1px solid var(--border);padding:16px;border-radius:16px;text-align:center}
    .kpi span{display:block;color:var(--muted)}
    .kpi strong{font-size:28px}

    canvas{max-width:100%}
  </style>
</head>
<body>
  <header>
    <img src="./img/logo-comfenalco.png" alt="Logo" style="height:36px">
    <h1>Seguridad Delagente</h1>
    <div class="nav">
      <button id="btnTheme" class="btn ghost">Tema</button>
      <button id="btnDashTop" class="btn ghost">Dashboard</button>
      <button id="btnCheckTop" class="btn ghost">Checklist</button>
      <button id="btnLogin" class="btn">Iniciar sesión</button>
      <button id="btnLogout" class="btn ghost hidden">Cerrar sesión</button>
    </div>
  </header>

  <main class="container">
    <div class="tabs">
      <button class="tabbtn active" data-tab="tab-dashboard">Dashboard</button>
      <button class="tabbtn" data-tab="tab-checklist">Checklist</button>
    </div>

    <!-- DASHBOARD -->
    <section id="tab-dashboard">
      <div class="grid grid-3">
        <div class="card">
          <span class="chip">Gobierno de Información</span>
          <h2 style="margin:10px 0 6px 0">Seguridad Delagente</h2>
          <p class="muted">
            Seguridad Delagente es una Evaluación de Ciberseguridad gratuita promovida por el área de Gobierno de Información.
            Su propósito es proporcionar conocimiento en temas de ciberseguridad para todos los colaboradores de la corporación.
            Está dirigida tanto a quienes no tienen experiencia previa como a quienes ya cuentan con conocimientos.
          </p>

          <div class="grid grid-2" style="margin-top:12px">
            <div class="kpi"><strong id="kpiEss">0%</strong><span>Esencial</span></div>
            <div class="kpi"><strong id="kpiOpt">0%</strong><span>Opcional</span></div>
            <div class="kpi"><strong id="kpiAdv">0%</strong><span>Avanzado</span></div>
          </div>
        </div>

        <div class="card">
          <h3 style="margin-top:0">Distribución de ítems</h3>
          <canvas id="radarChart" height="280"></canvas>
        </div>

        <div class="card">
          <h3 style="margin-top:0">Avance por categoría</h3>
          <canvas id="barChart" height="280"></canvas>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3 style="margin:0 0 10px 0">Progreso global</h3>
        <div class="progressWrap"><div id="globalBar" class="progressBar"></div></div>
        <div class="muted" style="margin-top:8px">
          <strong id="globalPct">0%</strong> (<span id="globalCount">0</span> / <span id="globalTotal">0</span> ítems)
        </div>
      </div>
    </section>

    <!-- CHECKLIST -->
    <section id="tab-checklist" class="hidden">
      <div class="card">
        <h2 style="margin:0 0 6px 0">Checklist</h2>
        <p class="muted">Marca los ítems completados. Se guardan por usuario autenticado; sin login se usan los datos del usuario “anónimo”.</p>
      </div>
      <div id="checklistContainer" style="margin-top:16px"></div>
    </section>
  </main>

  <!-- Charts, Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./script.supabase.js"></script>
</body>
</html>
