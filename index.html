<!doctype html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Seguridad Delagente</title>
  <link rel="icon" href="data:," />
  <style>
    :root{
      --bg:#0f141a; --panel:#121821; --muted:#94a3b8; --text:#e6edf3; --accent:#27c093;
      --card:#0e1624; --border:#253244; --chip:#1f2a3a;
    }
    [data-theme="light"]{
      --bg:#f6f8fb; --panel:#ffffff; --muted:#445; --text:#0e1624; --accent:#0aa37f;
      --card:#ffffff; --border:#e6ebf2; --chip:#eef3f8;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Arial}
    header{position:sticky;top:0;z-index:5;background:var(--panel);border-bottom:1px solid var(--border);padding:.75rem 1rem;display:flex;align-items:center;gap:1rem}
    header img{height:36px}
    header h1{font-size:1.1rem;margin:0;font-weight:700}
    .grow{flex:1}
    .btn{background:#223; color:#cfd6df; border:1px solid var(--border); padding:.55rem .9rem; border-radius:10px; cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .btn.primary{background:var(--accent); color:#06241c; border-color:transparent; font-weight:700}
    .tabs{display:flex; gap:.5rem; margin:.5rem 0 1rem 0}
    .tabbtn{padding:.5rem .9rem;border-radius:10px;background:var(--chip);color:var(--text);cursor:pointer;border:1px solid var(--border)}
    .tabbtn.active{background:var(--accent);color:#06241c}
    .wrap{max-width:1200px;margin:1rem auto;padding:0 1rem}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:1rem; min-height:340px}
    .card h3{margin:0 0 .25rem 0}
    .muted{color:var(--muted); font-size:.9rem}
    .footer{margin:1rem 0; color:var(--muted); text-align:center}
    .row{display:flex; gap:.75rem; align-items:center; flex-wrap:wrap}
    .hidden{display:none !important}
    .progressbar{height:8px;background:var(--chip);border-radius:8px;overflow:hidden}
    .progressbar > span{display:block;height:100%;background:var(--accent)}
    .list{display:grid;gap:.5rem;margin-top:.5rem}
    .item{display:flex;align-items:center;gap:.6rem;padding:.5rem;border-radius:10px;background:var(--panel);border:1px solid var(--border)}
    .item input{transform:scale(1.2)}
    .catHead{display:flex;align-items:center;justify-content:space-between;margin:.25rem 0}
    .chip{background:var(--chip); padding:.15rem .5rem; border-radius:999px; font-size:.8rem}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }
  </style>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <!-- Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body>
  <header>
    <img src="./img/logo-comfenalco.png" alt="Logo" onerror="this.style.visibility='hidden'">
    <h1>Seguridad Delagente</h1>
    <div class="grow"></div>
    <button class="btn" id="btnTheme">Tema</button>
    <button class="btn" id="btnDashTop">Dashboard</button>
    <button class="btn" id="btnCheckTop">Checklist</button>
    <button class="btn primary" id="btnLogin">Iniciar sesión</button>
    <button class="btn hidden" id="btnLogout">Cerrar sesión</button>
  </header>

  <div class="wrap">
    <div class="tabs">
      <button class="tabbtn active" data-tab="tab-dashboard">Dashboard</button>
      <button class="tabbtn" data-tab="tab-checklist">Checklist</button>
    </div>

    <section id="tab-dashboard" class="grid">
      <div class="card">
        <h3>Avance por categoría</h3>
        <div class="muted">Barras horizontales. Haz clic en una categoría para ir al detalle.</div>
        <canvas id="barChart" style="max-height:260px;margin-top:8px"></canvas>
      </div>

      <div class="card">
        <h3>Distribución de ítems</h3>
        <div class="muted">Gráfico tipo malla (radar) conectado al avance real.</div>
        <canvas id="radarChart" style="max-height:260px;margin-top:8px"></canvas>
      </div>

      <div class="card" style="grid-column:1/-1">
        <h3>Progreso global</h3>
        <div class="progressbar" style="margin:.5rem 0 10px 0"><span id="globalBar" style="width:0%"></span></div>
        <div class="row">
          <div class="chip">Completado: <b id="globalPct">0%</b></div>
          <div class="muted">(<span id="globalCount">0</span> / <span id="globalTotal">0</span> ítems)</div>
        </div>
      </div>
    </section>

    <section id="tab-checklist" class="card hidden">
      <h3>Checklist</h3>
      <div class="muted" style="margin-bottom:.5rem">Marca los ítems completados. Se guardan por usuario autenticado; sin login se usan los datos del usuario “anónimo”.</div>
      <div id="checklistContainer"></div>
    </section>

    <div class="footer">© Comfenalco Valle — Seguridad Delagente</div>
  </div>

  <!-- Modal de login simple (OTP por correo) -->
  <template id="tplLogin">
    <div class="card" style="max-width:520px;margin:2rem auto">
      <h3>Iniciar sesión</h3>
      <p class="muted">Ingresa tu correo. Te enviaremos un enlace mágico (OTP).</p>
      <div class="row">
        <input id="emailInput" type="email" placeholder="tu@correo.com" style="flex:1;padding:.6rem;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text)">
        <button class="btn primary" id="sendLink">Enviar enlace</button>
        <button class="btn" id="closeLogin">Cerrar</button>
      </div>
      <div id="loginMsg" class="muted" style="margin-top:.5rem"></div>
    </div>
  </template>

  <script src="./script.supabase.js"></script>
</body>
</html>
